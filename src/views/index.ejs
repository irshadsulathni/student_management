<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Management</title>
    <link rel="stylesheet" href="/style.css">
    <!-- Include Font Awesome for icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <!-- SweetAlert CDN -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <link rel="icon" href="data:image/png;base64,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" type="image/x-icon">
  </head>
<body>
  <div class="container">
    <header>
      <h1>
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSCCS2cAJeASqZsXee8zSB_CYBa0VU3b-AKVw&s" class="header-icon" alt="Student Icon" /> Student Management
      </h1>
    </header>
    
    <main>
      <section class="form-section">
        <h2>Add New Student</h2>
        <form action="/add" method="POST">
          <input type="text" name="name" placeholder="Name" required />
          <input type="number" name="age" placeholder="Age" pattern="\d*" required />
          <input type="text" name="grade" placeholder="Grade" required />
          <input type="email" name="email" placeholder="Email" required />
          <button type="submit">Add Student</button>
        </form>
      </section>

      <section class="student-list">
        <h2>Student List</h2>
        <ul>
          <% students.forEach(student => { %>
            <li>
              <div class="student-info">
                <span><%= student.name %> (<%= student.email %>) - <%= student.grade %></span>
                <div class="action-buttons">
                  <a href="#" class="btn update" onclick="openUpdateForm('<%= student._id %>', '<%= student.name %>', '<%= student.age %>', '<%= student.grade %>', '<%= student.email %>')">
                    <i class="fas fa-edit"></i> Update
                  </a>                  
                  <a href="/delete/<%= student._id %>" class="btn delete">
                    <i class="fas fa-trash-alt"></i> Delete
                  </a>
                </div>
              </div>
            </li>
          <% }) %>
        </ul>
      </section>
      <div id="updateModal" style="display:none;">
        <form id="updateForm">
          <input type="text" name="name" id="name" required />
          <input type="number" name="age" id="age" required />
          <input type="text" name="grade" id="grade" required />
          <input type="email" name="email" id="email" required />
          <button type="submit">Update Student</button>
        </form>
      </div>
    </main>
  </div>
  <script>
    document.querySelector('form').onsubmit = function(event) {
  event.preventDefault();  // Prevent default form submission
  
  const formData = {
    name: document.querySelector('[name="name"]').value,
    age: document.querySelector('[name="age"]').value,
    grade: document.querySelector('[name="grade"]').value,
    email: document.querySelector('[name="email"]').value
  };
  
  fetch('/add', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(formData)
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      Swal.fire({
        title: 'Success!',
        text: data.message,
        icon: 'success',
        confirmButtonText: 'OK'
      }).then(() => {
        window.location.reload();  // Reload to show the newly added student in the list
      });
    } else {
      Swal.fire({
        title: 'Error!',
        text: data.message || 'There was an issue adding the student.',
        icon: 'error',
        confirmButtonText: 'Try Again'
      });
    }
  })
  .catch(error => {
    console.error('Error:', error);
    Swal.fire({
      title: 'Error!',
      text: 'An unexpected error occurred.',
      icon: 'error',
      confirmButtonText: 'Try Again'
    });
  });
};



    // for updating
    function openUpdateForm(id, name, age, grade, email) {
  document.getElementById('name').value = name;
  document.getElementById('age').value = age;
  document.getElementById('grade').value = grade;
  document.getElementById('email').value = email;
  document.getElementById('updateModal').style.display = 'block';  // Show the modal form
  
  // Set the form's submit handler
  document.getElementById('updateForm').onsubmit = function(event) {
    event.preventDefault();  // Prevent default form submission
    
    const formData = {
      name: document.getElementById('name').value,
      age: document.getElementById('age').value,
      grade: document.getElementById('grade').value,
      email: document.getElementById('email').value
    };
    console.log('Sending data:', formData);
    
    // Send the PUT request using fetch
    fetch('/update/' + id, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(formData)
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        // Show success with SweetAlert
        Swal.fire({
          title: 'Success!',
          text: 'Student updated successfully.',
          icon: 'success',
          confirmButtonText: 'OK'
        }).then(() => {
          window.location.reload();  // Reload the page to see the updated data
        });
      } else {
        // Show error with SweetAlert
        Swal.fire({
          title: 'Error!',
          text: data.message || 'There was an issue updating the student.',
          icon: 'error',
          confirmButtonText: 'Try Again'
        });
      }
    })
    .catch(error => {
      console.error('Error:', error);
      // Show error with SweetAlert in case of network or server error
      Swal.fire({
        title: 'Error!',
        text: 'An unexpected error occurred.',
        icon: 'error',
        confirmButtonText: 'Try Again'
      });
    });
  };
}
  </script>
  
  
</body>
</html>
